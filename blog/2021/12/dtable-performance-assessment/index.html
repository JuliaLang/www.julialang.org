<!doctype html>
<html lang="en">
<head>
	<!-- parts for all pages -->
	<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="author" content="Jeff Bezanson, Stefan Karpinski, Viral Shah, Alan Edelman, et al.">
<meta name="description" content="The official website for the Julia Language. Julia is a language that is fast, dynamic, easy to use, and open source. Click here to learn more.">
<meta name="robots" content="max-image-preview:large">
<meta name="twitter:site:id" content="1237720952"> <!-- @JuliaLanguage -->
<meta name="google-site-verification" content="9VDSjBtchQj6PQYIVwugTPY7pVCfLYgvkXiRHjc_Bzw" /> <!-- Google News Feed -->


	<link rel="icon" href="/assets/infra/julia.ico">

  <!-- Franklin stylesheets for generated pages -->
   <link rel="stylesheet" href="/libs/katex/katex.min.css">
      
  

	<!-- NOTE: specific stylesheets -->
<link rel="stylesheet" href="/libs/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="/css/app.css">
<link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/fonts.css">
<link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i" rel="stylesheet">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script async defer src="/libs/buttons.js"></script>
<script src="/libs/clipboard.min.js"></script>
<script src="/libs/detectdark.js"></script>


<script defer data-domain="julialang.org" src="https://plausible.io/js/script.js"></script>

<!-- scripts for map rendering -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
 integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
 crossorigin=""></script>

<!-- https://github.com/Leaflet/Leaflet.markercluster -->
<script src="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.4.1/dist/leaflet.markercluster-src.min.js"></script>

<script src="https://kit.fontawesome.com/f030d443fe.js" crossorigin="anonymous"></script>


   <title>DTable – an early performance assessment of a new distributed table implementation</title>   

  
  <style>
	  .container ul li p {margin-bottom: 0;}
		.container ol li p {margin-bottom: 0;}
		.container ul ul {margin: .4em 0 .4em 0;}
		.container ul ol {margin: .4em 0 .4em 0;}
		.container ol ul {margin: .4em 0 .4em 0;}
		.container ol ol {margin: .4em 0 .4em 0;}
  </style>
  

  <!-- Specific style for blog pages (except the /blob/index) -->
  
  <style>
    .main { font-family: Georgia; }
    .main pre {
  	  margin-left: auto;
  	  margin-right: auto;
    }
    .main { width: 100%; font-size: 100%; }
    .main code { font-size: 90%; }
    .main pre code { font-size: 90%; }
    @media (min-width: 940px) {
      .main { width: 800px; }
      .container.blog-title { width: 800px;}
    }
  </style>
  

  <!-- OGP Metadata -->
	<meta property="og:title" content="DTable – an early performance assessment of a new distributed table implementation">
<meta property="og:description" content="DTable – an early performance assessment of a new distributed table implementation">
<meta property="og:image" content="/assets/images/julia-open-graph.png">


</head>

<body>

<div class="container py-3 py-lg-0">
  <nav class="navbar navbar-expand-lg navbar-light bg-light" id="main-menu">
    <!-- LOGO -->
    <a class="navbar-brand" href="/">
      <img class="julialogo" src="/assets/infra/logo.svg" alt="JuliaLang Logo">
    </a>

    <button class="navbar-toggler ml-auto hidden-sm-up float-xs-left" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

      <!-- MENU: DOWNLOAD | DOCUMENTATION | BLOG ... -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item   flex-md-fill text-md-center">
          <a class="nav-link" href="/downloads/">Download</a>
        </li>
        <li class="nav-item flex-md-fill text-md-center">
          <a class="nav-link" href="https://docs.julialang.org">Documentation</a>
        </li>
        <li class="nav-item   flex-md-fill text-md-center">
          <a class="nav-link" href="/learning/">Learn</a>
        </li>
        <li class="nav-item active flex-md-fill text-md-center">
          <a class="nav-link" href="/blog/">Blog</a>
        </li>
        <li class="nav-item   flex-md-fill text-md-center">
          <a class="nav-link" href="/community/">Community</a>
        </li>
        <li class="nav-item   flex-md-fill text-md-center">
          <a class="nav-link" href="/contribute/">Contribute</a>
        </li>
        <li class="nav-item   flex-md-fill text-md-center">
          <a class="nav-link" href="/jsoc/">JSoC</a>
        </li>
      </ul>
      <span class="navbar-right">
        <a class="github-button" href="https://github.com/JuliaLang/julia" data-size="large" data-show-count="true" aria-label="Star JuliaLang/julia on GitHub">Star</a>
        <a class="github-button" href="https://github.com/sponsors/julialang" data-icon="octicon-heart" data-size="large" aria-label="Sponsor @julialang on GitHub">Sponsor</a>
      </span>
    </div>

  </nav>
</div>


<br><br>


<div class="container blog-title">
  <h1>DTable – an early performance assessment of a new distributed table implementation
    <a type="application/rss+xml" href="https://julialang.org/feed.xml">
      <i class="fa fa-rss-square rss-icon"></i>
    </a>
  </h1>
  <h3>
   <span style="font-weight: lighter;"> 08 December 2021 </span>
	|
	
	 <span style="font-weight: bold;"></span> 
  <!-- assumption that only one of the two is defined -->
   <span style="font-weight: bold;">Krystian Guliński </span> 
  </h3>
</div>



<a href="https://github.com/JuliaLang/www.julialang.org/blob/master/blog/2021/12/dtable-performance-assessment.md" title="Edit this page on GitHub" class="edit-float">
</a>


<!-- Content appended here -->
<div class="container main"><p>In a recent survey conducted within the Julia community, the functionality to process tabular data larger than available RAM came out on top, above all other priorities. While Julia already has some tools for so-called &quot;out-of-core processing&quot;, they are not very popular within the community, and have been mostly left unmaintained &#40;e.g. <code>JuliaDB</code>&#41;.</p>
<p>The <code>DTable</code> plans to address this popular use case in a composable manner by leveraging the current Julia data ecosystem and our existing distributed computing and memory management capabilities. We hope it&#39;s a major step towards a native Julia tool that will handle the out-of-core tabular data processing needs of the Julia community&#33;</p>
<div class="franklin-toc"><ol><li><a href="#what_is_the_dtable">What is the <code>DTable</code>?</a></li><li><a href="#why_the_dtable">Why the DTable?</a><ol><li><a href="#operations_available_today">Operations available today</a></li></ol></li><li><a href="#initial_performance_comparison_multithreaded">Initial performance comparison &#40;multithreaded&#41;</a><ol><li><a href="#benchmark_configuration">Benchmark configuration</a></li></ol></li><li><a href="#basic_operations_map_filter_reduce">Basic operations &#40;<code>map</code>, <code>filter</code>, <code>reduce</code>&#41;</a><ol><li><a href="#map_single_column_increment">Map &#40;single column increment&#41;</a></li><li><a href="#filter">Filter</a></li><li><a href="#reduce_single_column">Reduce &#40;single column&#41;</a></li><li><a href="#reduce_all_columns">Reduce &#40;all columns&#41;</a></li></ol></li><li><a href="#grouped_operations">Grouped operations</a><ol><li><a href="#groupby_shuffle">Groupby &#40;shuffle&#41;</a></li><li><a href="#grouped_reduction_single_column">Grouped reduction &#40;single column&#41;</a></li><li><a href="#grouped_reduction_all_columns">Grouped reduction &#40;all columns&#41;</a></li></ol></li><li><a href="#implementation_details_for_interested_users">Implementation details &#40;for interested users&#41;</a></li><li><a href="#some_caveats">Some caveats</a></li><li><a href="#conclusion">Conclusion</a></li></ol></div>
<h1 id="what_is_the_dtable"><a href="#what_is_the_dtable" class="header-anchor">What is the <code>DTable</code>?</a></h1>
<p>The <code>DTable</code> is a table structure providing distributed partitioning of data, and parallelization of operations performed on it, in any supported environment. It&#39;s built on top of <code>Dagger.jl</code>, which enables it to work in any worker and thread setup by letting Dagger take care of task scheduling and memory management. Any <code>Tables.jl</code> compatible source can be ingested by the <code>DTable</code>, and the <code>DTable</code> can also act as a sink in case you move the data somewhere else &#40;such as to a CSV&#41;.</p>
<p>A key feature is that the <code>DTable</code> doesn&#39;t use any dedicated structure for storing the table data in memory. Any <code>Tables.jl</code> compatible table type can be used for internal storage, which allows for greater composability with the ecosystem, and all of the advantages of the chosen table type. To further support this goal, the set of operations that can be performed on a <code>DTable</code> is generic and only relies on interfaces offered by <code>Tables.jl</code>.</p>
<p>The diagram below presents a simple visual explanation of how the <code>DTable</code> and <code>GDTable</code> &#40;grouped <code>DTable</code>&#41; are built. Provided table input will be partitioned according to either a <code>chunksize</code> argument or the existing partitioning &#40;using the <code>Tables.partitions</code> interface&#41;. After performing a <code>groupby</code> operation the data will be shuffled accordingly and new &quot;chunks&quot; &#40;Dagger partitions&#41; containing only the data belonging to specific keys will be created. Along with an <code>index</code>, these chunks form a <code>GDTable</code>.</p>

<p align="center">
  <img src="/assets/blog/2021-dtable/dtable_diagram.svg" />
</p>

<h1 id="why_the_dtable"><a href="#why_the_dtable" class="header-anchor">Why the DTable?</a></h1>
<p>The <code>DTable</code> aims to excel in two areas:</p>
<ul>
<li><p>parallelization of data processing</p>
</li>
<li><p>out-of-core processing &#40;will be available through future <code>Dagger.jl</code> upgrades&#41;</p>
</li>
</ul>
<p>The goal is to become competitive with similar tools, such as <code>Dask</code> or <code>Spark</code>, so that Julia users can solve and scale their problems within Julia.</p>
<p>By leveraging the composability of the Julia data ecosystem, we can reuse a lot of existing functionality in order to achieve the above goals, and continue improving the solution in the future instead of just creating another monolithic solution.</p>
<h2 id="operations_available_today"><a href="#operations_available_today" class="header-anchor">Operations available today</a></h2>
<p>Below is a list of functionality generally available today. To post suggestions for new operations, please comment in this <a href="https://github.com/JuliaParallel/Dagger.jl/issues/273">GitHub issue</a>. In the future we hope to provide a roadmap and priority indicators for planned functionality.</p>
<ul>
<li><p><code>map</code></p>
</li>
<li><p><code>filter</code></p>
</li>
<li><p><code>reduce</code></p>
</li>
<li><p><code>groupby</code> &#40;shuffle with full data movement&#41;</p>
</li>
<li><p>grouped <code>reduce</code></p>
</li>
<li><p>constructors for consuming <code>Tables.jl</code> compatible input</p>
</li>
<li><p>compatibility with <code>Tables.jl</code> &#40;<code>DTable</code> can be used as a source or sink&#41;</p>
</li>
</ul>
<h1 id="initial_performance_comparison_multithreaded"><a href="#initial_performance_comparison_multithreaded" class="header-anchor">Initial performance comparison &#40;multithreaded&#41;</a></h1>
<p>The benchmarks below present the initial performance assessment of the <code>DTable</code> compared to <code>DataFrames.jl</code>, which is currently the go-to data processing package in Julia, and to <code>Dask</code> - the main competitor to <code>Dagger</code> and the <code>DTable</code>. The <code>DataFrames.jl</code> benchmarks are here to provide a reference to what the performance in Julia looks like today.</p>
<p>Please note that the benchmarks below were specifically prepared with the focus on comparing the same type of processing activities. That means the benchmark code was accordingly adjusted to make sure the packages are doing the same set of operations under the hood.</p>
<p>The table below presents the summary of the results obtained in a one-machine multithreaded environment &#40;exact setup in the next section&#41;. Times from every configuration of each benchmark were compared and summarized in the table. Negative values mean a slowdown versus the competitor.</p>
<table><tr><th align="right">Operation</th><th align="right">times faster than Dask</th><th align="right">times faster than DataFrames.jl</th></tr><tr><td align="right">Map</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4.9</mn></mrow><annotation encoding="application/x-tex">4.9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mord">.</span><span class="mord">9</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2.5</mn></mrow><annotation encoding="application/x-tex">-2.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">2</span><span class="mord">.</span><span class="mord">5</span></span></span></span></td></tr><tr><td align="right">Filter</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1.6</mn></mrow><annotation encoding="application/x-tex">-1.6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mord">.</span><span class="mord">6</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>14.5</mn></mrow><annotation encoding="application/x-tex">-14.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mord">4</span><span class="mord">.</span><span class="mord">5</span></span></span></span></td></tr><tr><td align="right">Reduce &#40;single column&#41;</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>31.1</mn></mrow><annotation encoding="application/x-tex">31.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">1</span><span class="mord">.</span><span class="mord">1</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2.9</mn></mrow><annotation encoding="application/x-tex">2.9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">.</span><span class="mord">9</span></span></span></span></td></tr><tr><td align="right">Reduce &#40;all columns&#41;</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>27.1</mn></mrow><annotation encoding="application/x-tex">27.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">7</span><span class="mord">.</span><span class="mord">1</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3.7</mn></mrow><annotation encoding="application/x-tex">3.7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord">.</span><span class="mord">7</span></span></span></span></td></tr><tr><td align="right">Groupby &#40;shuffle&#41;</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>17.5</mn></mrow><annotation encoding="application/x-tex">17.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">7</span><span class="mord">.</span><span class="mord">5</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>974.5</mn></mrow><annotation encoding="application/x-tex">-974.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">9</span><span class="mord">7</span><span class="mord">4</span><span class="mord">.</span><span class="mord">5</span></span></span></span></td></tr><tr><td align="right">Reduce per group &#40;single column&#41;</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20.2</mn></mrow><annotation encoding="application/x-tex">20.2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>343.0</mn></mrow><annotation encoding="application/x-tex">-343.0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">3</span><span class="mord">4</span><span class="mord">3</span><span class="mord">.</span><span class="mord">0</span></span></span></span></td></tr><tr><td align="right">Reduce per group &#40;all columns&#41;</td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>22.3</mn></mrow><annotation encoding="application/x-tex">22.3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">2</span><span class="mord">.</span><span class="mord">3</span></span></span></span></td><td align="right"><span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>166.1</mn></mrow><annotation encoding="application/x-tex">-166.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">−</span><span class="mord">1</span><span class="mord">6</span><span class="mord">6</span><span class="mord">.</span><span class="mord">1</span></span></span></span></td></tr></table>
<h2 id="benchmark_configuration"><a href="#benchmark_configuration" class="header-anchor">Benchmark configuration</a></h2>
<p>Benchmark code and raw results can be found in <a href="https://github.com/krynju/dtable_benchmarks">this repository</a>.</p>
<p>All benchmark runs were performed on a desktop with the following specifications:</p>
<ul>
<li><p>CPU: Ryzen 5800X 8 cores / 16 threads</p>
</li>
<li><p>Memory: 32 GB DDR4 RAM</p>
</li>
<li><p>Julia: master/1.8 &#40;custom branch&#41;</p>
</li>
</ul>
<p>All configurations were ran using an environment with 1 worker and 16 threads.</p>
<p>The data used for the experiments was prepared as follows:</p>
<ul>
<li><p>column count: <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> &#40;to allow for a distinction between single and all column benchmarks&#41;</p>
</li>
<li><p>row count: <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span></p>
</li>
<li><p>row value type: <code>Int32</code></p>
</li>
<li><p>row value range: <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>:</mo><mi>u</mi><mi>n</mi><mi>i</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi mathvariant="normal">_</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">1:unique\_values</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span></span></span></span> &#40;important for <code>groupby</code> ops&#41;</p>
</li>
<li><p>chunksize &#40;<code>Dask</code> and <code>DTable</code> only&#41;: <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow><annotation encoding="application/x-tex">10^6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding="application/x-tex">10^7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span></p>
</li>
</ul>
<p>The diagram below summarizes the above specifications:</p>

<p align="center">
  <img src="/assets/blog/2021-dtable/table_specs.svg" />
</p>

<h1 id="basic_operations_map_filter_reduce"><a href="#basic_operations_map_filter_reduce" class="header-anchor">Basic operations &#40;<code>map</code>, <code>filter</code>, <code>reduce</code>&#41;</a></h1>
<p>These three operations are the base for the majority of functionality of any table structure. By looking at their performance, we can get a good grasp of how the table is doing in many common data transformation scenarios.</p>
<p>These basic operations are unaffected by the count of unique values, so the results of these comparisons are not included here.</p>
<h2 id="map_single_column_increment"><a href="#map_single_column_increment" class="header-anchor">Map &#40;single column increment&#41;</a></h2>
<p>In the first benchmark we&#39;re performing a simple <code>map</code> operation on the full table.</p>
<p>At first glance it&#39;s clear that the overhead coming from the partitioning and parallelization present in the <code>DTable</code> and <code>Dask</code> is not paying off in this benchmark. The <code>DataFrames.jl</code> package is leading here with the <code>DTable</code> being on average 2.5 times slower.</p>
<p>At the smaller chunksize &#40;<code>10^6</code>&#41; the <code>DTable</code> is scaling better than its competitor, which isn&#39;t greatly affected by that parameter. Overall the <code>DTable</code> managed to offer an average ~4.9 times speedup compared to <code>Dask</code> across all the tested configurations.</p>
<p>DTable command: <code>map&#40;row -&gt; &#40;r &#61; row.a1 &#43; 1,&#41;, d&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/inrement_map.svg" alt="" /></p>
<h2 id="filter"><a href="#filter" class="header-anchor">Filter</a></h2>
<p>As the set of values is limited, a simple filter expression was chosen, which filters out approximately half of the records &#40;command below&#41;.</p>
<p>In this scenario, the parallelization and partitioning overhead doesn&#39;t pay off as well as both <code>DTable</code> and <code>Dask</code> are noticeably slower than <code>DataFrames.jl</code>. When it comes to the comparison of these two implementations, the performance looks very similiar with <code>Dask</code> being on average 1.6 times faster than the <code>DTable</code>.</p>
<p>The scaling of the <code>DTable</code> allows it to catch up to <code>DataFrames</code> at the largest data size. It&#39;s possible that this behavior may continue at larger data sizes and eventually provide a speedup versus <code>DataFrames</code> after some threshold.</p>
<p>DTable command: <code>filter&#40;row -&gt; row.a1 &lt; unique_values ÷ 2, d&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/filter_half.svg" alt="" /></p>
<h2 id="reduce_single_column"><a href="#reduce_single_column" class="header-anchor">Reduce &#40;single column&#41;</a></h2>
<p>The reduce benchmarks are the place where the <code>DTable</code> really shines. This task can easily leverage the partitioning of the data in order to achieve a speed increase.</p>
<p>The <code>DTable</code> has not only managed to successfully perform faster than <code>DataFrames.jl</code> &#40;on average ~2.9 times faster&#41;, but it also managed to significantly beat <code>Dask</code>&#39;s performance by offering a ~31.1 times speedup.</p>
<p>Please note that both <code>DTable</code> and <code>DataFrames.jl</code> are using <code>OnlineStats.jl</code> to obtain the variance, while <code>Dask</code> is using its own native implementation. All reduction benchmarks in this post are focused on testing the performance of classic reduction functions such as <code>&#40;acc, x&#41; -&gt; acc &#43; x</code>.</p>
<p>In order to compute common statistics <code>DataFrames.jl</code> users should use array functions available in <code>Statistics.jl</code> instead &#40;e.g. <code>mean</code>, <code>var</code>&#41;. They provide better performance, but were not used here as they are not classic reduction functions.</p>
<p>DTable command: <code>reduce&#40;fit&#33;, d, cols&#61;&#91;:a1&#93;, init&#61;Variance&#40;&#41;&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/reduce_single_col.svg" alt="" /></p>
<h2 id="reduce_all_columns"><a href="#reduce_all_columns" class="header-anchor">Reduce &#40;all columns&#41;</a></h2>
<p>Similarly to the previous benchmark, the <code>DTable</code> is performing here very well by offering a ~3.7 times speedup over <code>DataFrames.jl</code>, and a ~27.1 times speedup over <code>Dask</code>.</p>
<p>Additional parallelization can be enabled in the future for wide tables. As of right now, the <code>DTable</code> is performing the reduction of all columns as a single task.</p>
<p>DTable command: <code>reduce&#40;fit&#33;, d, init&#61;Variance&#40;&#41;&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/reduce_allcols.svg" alt="" /></p>
<h1 id="grouped_operations"><a href="#grouped_operations" class="header-anchor">Grouped operations</a></h1>
<p>A table shuffle is definitely one of the most demanding operations that can be performed on a table, so that&#39;s why it was tackled early to evaluate whether the current technology stack makes it feasible to run such operations.</p>
<p>In the following benchmarks, the performance of <code>groupby</code> &#40;shuffle&#41; and grouped <code>reduce</code> are put to the test. Other operations like <code>map</code> and <code>filter</code> are also available for the <code>GDTable</code> &#40;grouped <code>DTable</code>&#41;, but they work in the same way as if they were performed on a <code>DTable</code>, so previously shown benchmarks still apply.</p>
<p>The following benchmarks include results obtained in tests with varying <code>unique_values</code> counts, since the number of them directly affects the number of groups generated through the grouping operation.</p>
<p>Please note that the testing scenarios were adjusted specifically to ensure that the benchmarks are measuring the same type of activity &#40;data shuffle&#41;. Most notably, <code>Dask</code> benchmarks use <code>shuffle</code> explicitly instead of <code>groupby</code> to avoid optimized <code>groupby/reduce</code> routines, which do not perform data movement. A better comparison can be performed in the future once the <code>DTable</code> supports these optimizations as well.</p>
<h2 id="groupby_shuffle"><a href="#groupby_shuffle" class="header-anchor">Groupby &#40;shuffle&#41;</a></h2>
<p>In this experiment we&#39;re looking at shuffle performance in various data configurations. <code>DataFrames.jl</code> doesn&#39;t perform data movement on groupby, so its performance is clearly superior to the other two technologies and is just included for reference purposes.</p>
<p>Let&#39;s focus on <code>Dask</code> and the <code>DTable</code>, which are performing data movement as part of the shuffle. Across the different data configurations, we can see a common pattern where the <code>DTable</code> is significantly faster than <code>Dask</code> at smaller data sizes, which leads to it offering an average ~17.5 times speedup, but as the data size grows the scaling of <code>Dask</code> is better and it eventually matches the speeds of the <code>DTable</code>.</p>
<p>However, in the more demanding configurations &#40;in which the <code>unique_values</code> count was equal to <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span>&#41;, <code>Dask</code> was repeatedly failing to finish the shuffle above a certain data size &#40;<span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> &gt; <span class="katex"><span class="katex-mathml"><math xmlns="https://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>8</mn></msup></mrow><annotation encoding="application/x-tex">10^8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span></span></span></span>&#41;. For that reason the following benchmarks will not include results for these failed tests. Those configurations are also excluded from the average performance comparison.</p>
<p>The <code>DTable</code> managed to finish these complex scenarios without any observable hit to scaling, which is a good sign, but future testing needs to be performed on larger data sizes to gain more insight into how well the current shuffle algorithm is performing.</p>
<p>DTable command: <code>Dagger.groupby&#40;d, :a1&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/groupby_single_col.svg" alt="" /></p>
<h2 id="grouped_reduction_single_column"><a href="#grouped_reduction_single_column" class="header-anchor">Grouped reduction &#40;single column&#41;</a></h2>
<p>Mimicking the success of reduction benchmarks, the <code>DTable</code> is again performing better here than the direct competition. For the single column reductions, it&#39;s an average ~20.2 times speedup over <code>Dask</code>, and their scaling behavior looks very similar.</p>
<p>Contrary to the standard reduction benchmarks, the <code>DTable</code> doesn&#39;t offer a speedup compared to <code>DataFrames.jl</code> across all the data sizes. It looks like the current algorithm has a significant overhead that can be observed as a lower bound to the performance at smaller data sizes. For the benchmarks with the smaller <code>unique_values</code> count, the <code>DTable</code> manages to catch up to <code>DataFrames.jl</code> at bigger data sizes. This may indicate that by increasing the data size further, we might eventually reach a point where the <code>DTable</code> provides a performance improvement over <code>DataFrames.jl</code> in this scenario.</p>
<p>DTable command: <code>r &#61; reduce&#40;fit&#33;, g, cols&#61;&#91;:a2&#93;, init&#61;Mean&#40;&#41;&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/grouped_reduce_mean_singlecol.svg" alt="" /></p>
<h2 id="grouped_reduction_all_columns"><a href="#grouped_reduction_all_columns" class="header-anchor">Grouped reduction &#40;all columns&#41;</a></h2>
<p>The results for the all-columns reduction look very similar to single-column. The <code>DTable</code> managed to offer an average ~22.3 times speeup over <code>Dask</code>.</p>
<p>Again, the <code>DTable</code> is heavily falling behind <code>DataFrames.jl</code> on smaller data sizes due to the significant entry overhead acting as a lower performance bound at smaller data sizes.</p>
<p>DTable command: <code>r &#61; reduce&#40;fit&#33;, g, init&#61;Mean&#40;&#41;&#41;</code></p>
<p><img src="/assets/blog/2021-dtable/grouped_reduce_mean_allcols.svg" alt="" /></p>
<h1 id="implementation_details_for_interested_users"><a href="#implementation_details_for_interested_users" class="header-anchor">Implementation details &#40;for interested users&#41;</a></h1>
<p>The <code>DTable</code> is built on top of <code>Dagger</code> and <code>Tables.jl</code>, and currently resides within the <code>Dagger.jl</code> package. That means it can run in any environment <code>Dagger</code> is capable of running in. You should be able to use the <code>DTable</code> effectively on your local machine in a threaded environment, on a bigger machine with many workers and threads, or have the workload spread around multiple machines and workers in your cluster.</p>
<p>The <code>DTable</code> uses <code>Dagger</code>&#39;s new &quot;Eager API&quot;, which means that all the parallelized calls are executed using <code>Dagger.spawn</code> and <code>Dagger.@spawn</code>. Memory is managed by <code>Dagger</code> through the usage of <code>MemPool.jl</code>. Upgrades to the related projects in the future will hopefully yield performance and functionality improvements for the <code>DTable</code>.</p>
<p>Because of the dependencies of the <code>DTable</code> on other projects, its focus is completely on delivering <code>Tables.jl</code> compatible algorithms and interfaces to address the growing needs for processing big tabular data.</p>
<p>We hope that the <code>Tables.jl</code> interface will grow to include an even wider range of functionality while still providing great intercompatibility with other Julia packages.</p>
<p>For more details, please visit the <a href="https://juliaparallel.github.io/Dagger.jl/dev/">Dagger documentation</a>.</p>
<h1 id="some_caveats"><a href="#some_caveats" class="header-anchor">Some caveats</a></h1>
<p>There are some pending PRs that haven&#39;t been merged into Julia yet that improve the thread safety of <code>Distributed</code>, which directly affects <code>Dagger.jl</code> stability. The user experience may occasionally be interrupted when extensively using the <code>DTable</code> in a threaded or mixed environment by occasional hangs or crashes.</p>
<p>We hope to include all the necessary fixes in future patches to Julia 1.7.</p>
<h1 id="conclusion"><a href="#conclusion" class="header-anchor">Conclusion</a></h1>
<p>The <code>DTable</code> has successfully passed the proof-of-concept stage and is currently under active development as a part of the <code>Dagger.jl</code> package.</p>
<p>This early performance assessment has confirmed that the <code>DTable</code> has the potential to become a competitive tool for processing tabular data. It managed to perform significantly better than direct competition &#40;<code>Dask</code>&#41; in 6 out of 7 presented benchmarks and in the remaining one it doesn&#39;t fall too far behind. While this looks promising there&#39;s still a lot of work ahead in order to make the <code>DTable</code> feature-rich and even faster, so keep an eye out for future updates on the project.</p>
<p>Functionality presented as part of this blogpost is generally available as of today. We highly encourage everyone to have a look at the documentation and to try out the examples included&#33; Due to the fact that the <code>DTable</code> is still in early development, it&#39;s very much possible to provide feedback and affect the roadmap and future design decisions.</p>
</div><br><br>

<!-- CONTENT ENDS HERE -->
    
        



    
    

    <!-- http://tutsplus.github.io/clipboard/ -->

<script>
(function(){

	// Get the elements.
	// - the 'pre' element.
	// - the 'div' with the 'paste-content' id.

	var pre = document.getElementsByTagName('pre');

	// Add a copy button in the 'pre' element.
	// which only has the className of 'language-' or ' hljs'(if enable highlight.js pre-render).

	for (var i = 0; i < pre.length; i++) {
		var tag_name = pre[i].children[0].className
            	var isLanguage = tag_name.startsWith('language-') || tag_name.endsWith(' hljs');
		if ( isLanguage ) {
			var button           = document.createElement('button');
					button.className = 'copy-button';
					button.textContent = 'Copy';

					pre[i].appendChild(button);
		}
	};

	// Run Clipboard

	var copyCode = new Clipboard('.copy-button', {
		target: function(trigger) {
			return trigger.previousElementSibling;
    }
	});

	// On success:
	// - Change the "Copy" text to "Copied".
	// - Swap it to "Copy" in 2s.
	// - Lead user to the "contenteditable" area with Velocity scroll.

	copyCode.on('success', function(event) {
		event.clearSelection();
		event.trigger.textContent = 'Copied';
		window.setTimeout(function() {
			event.trigger.textContent = 'Copy';
		}, 2000);

	});

	// On error (Safari):
	// - Change the  "Press Ctrl+C to copy"
	// - Swap it to "Copy" in 2s.

	copyCode.on('error', function(event) {
		event.trigger.textContent = 'Press "Ctrl + C" to copy';
		window.setTimeout(function() {
			event.trigger.textContent = 'Copy';
		}, 5000);
	});

})();
</script>


    <footer class="container-fluid footer-copy">
  <div class="container">
    <div class="row footrow">
      <ul>
        <li><a href="/project">About</a></li>
        <li><a href="/about/help">Get Help</a></li>
        <li><a href="/governance/">Governance</a></li>
        <li><a href="/research/#publications">Publications</a></li>
        <li><a href="/research/#sponsors">Sponsors</a></li>
      </ul>
      <ul>
        <li><a href="/downloads/">Downloads</a></li>
        <li><a href="/downloads/">All Releases</a></li>
        <li><a href="https://github.com/JuliaLang/julia">Source Code</a></li>
        <li><a href="/downloads/#current_stable_release">Current Stable Release</a></li>
        <li><a href="/downloads/#long_term_support_release">Longterm Support Release</a></li>
      </ul>
      <ul>
        <li><a href="https://docs.julialang.org/en/v1/">Documentation</a></li>
        <li><a href="https://juliaacademy.com">JuliaAcademy</a></li>
        <li><a href="https://www.youtube.com/user/JuliaLanguage">YouTube</a></li>
        <li><a href="/learning/getting-started/">Getting Started</a></li>
        <li><a href="https://docs.julialang.org/en/v1/manual/faq/">FAQ</a></li>
        <li><a href="/learning/books">Books</a></li>
      </ul>
      <ul>
        <li><a href="/community/">Community</a></li>
        <li><a href="/community/standards/">Code of Conduct</a></li>
        <li><a href="/community/stewards/">Stewards</a></li>
        <li><a href="/diversity/">Diversity</a></li>
        <li><a href="https://juliagenderinclusive.github.io">Julia Gender Inclusive</a></li>
        <li><a href="https://juliacon.org">JuliaCon</a></li>
        <li><a href="/community/#julia_user_and_developer_survey">User/Developer Survey</a></li>
        <li><a href="/shop/">Shop Merchandise</a></li>
      </ul>
      <ul>
        <li><a href="https://github.com/JuliaLang/julia/blob/master/CONTRIBUTING.md">Contributing</a></li>
        <li><a href="/contribute">Contributor's Guide</a></li>
        <li><a href="https://github.com/JuliaLang/julia/issues">Issue Tracker</a></li>
        <li><a href="https://github.com/JuliaLang/julia/security/policy">Report a Security Issue</a></li>
        <li><a href="https://github.com/search?q=is%3Aopen+is%3Aissue+language%3AJulia+label%3A%22help+wanted%22">Help Wanted Issues</a></li>
        <li><a href="https://github.com/search?q=is%3Aopen+is%3Aissue+language%3AJulia+label%3A%22good+first+issue%22">Good First Issue</a></li>
        <li><a href="https://docs.julialang.org/en/v1/devdocs/init/">Dev Docs</a></li>
      </ul>
    </div>
    <div id="footer-bottom" class="row">
      <div class="col-md-10 py-2">
        <p>Last modified: October 03, 2024. This site is powered by <a href="https://www.netlify.com">Netlify</a>, <a href="https://franklinjl.org">Franklin.jl</a>, and the <a href="https://julialang.org">Julia Programming Language</a>.</p>
        <p>We thank <a href="https://www.fastly.com">Fastly</a> for their generous infrastructure support.</p>
        <p>©2024 JuliaLang.org <a href="https://github.com/JuliaLang/www.julialang.org/graphs/contributors">contributors</a>. The content on this website is made available under the <a href="https://github.com/JuliaLang/www.julialang.org/blob/master/LICENSE.md">MIT license</a>.</p>
      </div>
      <div class="col-md-2 py-2">
        <span class="float-sm-right">
          <a class="github-button" href="https://github.com/sponsors/julialang" data-icon="octicon-heart" data-size="large" aria-label="Sponsor @julialang on GitHub">Sponsor</a>
        </span>
      </div>
    </div>
  </div>
</footer>

<script src="/libs/jquery/jquery.min.js"></script>
<script src="/libs/bootstrap/bootstrap.min.js"></script>
<!-- <script src="/libs/highlight/highlight.min.js"></script> -->
<!-- <script>hljs.initHighlightingOnLoad();</script> -->

    <script src="/libs/groups.js"></script>
    <script src="/libs/map.js"></script>
  </body>
</html>
