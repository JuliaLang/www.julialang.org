<!doctype html> <html lang=en > <meta charset=utf-8 > <meta name=viewport  content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name=author  content="Jeff Bezanson, Stefan Karpinski, Viral Shah, Alan Edelman, et al."> <meta name=description  content="The official website for the Julia Language. Julia is a language that is fast, dynamic, easy to use, and open source. Click here to learn more."> <meta name=robots  content="max-image-preview:large"> <meta name="twitter:site:id" content=1237720952 > <meta name=google-site-verification  content=9VDSjBtchQj6PQYIVwugTPY7pVCfLYgvkXiRHjc_Bzw  /> <link rel=icon  href="/assets/infra/julia.ico"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/libs/bootstrap/bootstrap.min.css"> <link rel=stylesheet  href="/css/app.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/fonts.css"> <link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i" rel=stylesheet > <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel=stylesheet > <script async defer src="/libs/buttons.js"></script> <script type="application/javascript"> var doNotTrack = false; if (!doNotTrack) { window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; ga('create', 'UA-28835595-1', 'auto', { 'anonymize_ip': true }); ga('send', 'pageview', { 'anonymize_ip': true }); } </script> <script async src='https://www.google-analytics.com/analytics.js'></script> <title>Julia 1.8 Highlights</title> <style> .container ul li p {margin-bottom: 0;} .container ol li p {margin-bottom: 0;} .container ul ul {margin: .4em 0 .4em 0;} .container ul ol {margin: .4em 0 .4em 0;} .container ol ul {margin: .4em 0 .4em 0;} .container ol ol {margin: .4em 0 .4em 0;} </style> <style> .main { font-family: Georgia; } .main pre { margin-left: auto; margin-right: auto; } .main { width: 100%; font-size: 100%; } .main code { font-size: 90%; } .main pre code { font-size: 90%; } @media (min-width: 940px) { .main { width: 800px; } .container.blog-title { width: 800px;} } </style> <meta property="og:title" content="Julia 1.8 Highlights"> <meta property="og:description" content="Highlights of the Julia 1.8 release."> <meta property="og:image" content="/assets/images/julia-open-graph.png"> <div class="container py-3 py-lg-0"> <nav class="navbar navbar-expand-lg navbar-light bg-light" id=main-menu > <a class=navbar-brand  href="/"> <img src="/assets/infra/logo.svg" alt="JuliaLang Logo"> </a> <button class="navbar-toggler ml-auto hidden-sm-up float-xs-left" type=button  data-toggle=collapse  data-target="#navbarSupportedContent" aria-controls=navbarSupportedContent  aria-expanded=false  aria-label="Toggle navigation"> <span class=navbar-toggler-icon ></span> </button> <div class="collapse navbar-collapse" id=navbarSupportedContent > <ul class="navbar-nav mx-auto"> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="/downloads/">Download</a> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="https://docs.julialang.org">Documentation</a> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="/learning/">Learn</a> <li class="nav-item active flex-md-fill text-md-center"> <a class=nav-link  href="/blog/">Blog</a> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="/community/">Community</a> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="/research/">Research</a> <li class="nav-item flex-md-fill text-md-center"> <a class=nav-link  href="/jsoc/">JSoC</a> </ul> <span class=navbar-right > <a class=github-button  href="https://github.com/sponsors/julialang" data-icon=octicon-heart  data-size=large  aria-label="Sponsor @julialang on GitHub">Sponsor</a> </span> </div> </nav> </div> <br><br> <div class="container blog-title"> <h1>Julia 1.8 Highlights <a type="application/rss+xml" href="https://julialang.org/feed.xml"> <i class="fa fa-rss-square rss-icon"></i> </a> </h1> <h3> <span style="font-weight: lighter;"> 18 August 2022 </span> | <span style="font-weight: bold;"></span> <span style="font-weight: bold;">Jeff Bezanson, Jameson Nash, Ian Butterworth, Kristoffer Carlsson, Shuhei Kadowaki, Elliot Saba, Mosè Giordano, Simeon Schaub, Tim Holy, Keno Fischer </span> </h3> </div> <a href="https://github.com/JuliaLang/www.julialang.org/blob/master/blog/2022/08/julia-1.8-highlights.md" title="Edit this page on GitHub" class=edit-float > </a> <div class="container main"> <h1 id=julia_18_highlights ><a href="#julia_18_highlights">Julia 1.8 highlights</a></h1> <p>After 3 betas and 4 release candidates, Julia version 1.8 has finally been released. We would like to thank all the contributors to this release and all the testers that helped with finding regressions and issues in the pre-releases. Without you, this release would not have been possible.</p> <p>The full list of changes can be found in the <a href="https://github.com/JuliaLang/julia/blob/release-1.8/NEWS.md">NEWS file</a>, but here we&#39;ll give a more in-depth overview of some of the release highlights.</p> <div class=franklin-toc ><ol><li><a href="#const_on_fields_in_mutable_structs"><code>const</code> on fields in <code>mutable structs</code></a><li><a href="#call_site_inline">Call site <code>@inline</code></a><li><a href="#typed_globals">Typed globals</a><li><a href="#new_default_scheduler_for_threads">New default scheduler for <code>@threads</code></a><li><a href="#profiling">Profiling</a><ol><li><a href="#new_allocation_profiler">New allocation profiler</a><li><a href="#updates_to_cpu_profiling">Updates to CPU profiling</a></ol><li><a href="#packages">Packages</a><ol><li><a href="#package_load_timing">Package load timing</a><li><a href="#pkg_status_update_with_upgradable_package_indicator">Pkg status update with upgradable package indicator</a><li><a href="#pkg_support_for_sysimages">Pkg support for sysimages</a></ol><li><a href="#improved_precompilation">Improved precompilation</a><li><a href="#improved_support_for_apple_silicon">Improved support for Apple Silicon</a></ol></div> <h2 id=const_on_fields_in_mutable_structs ><a href="#const_on_fields_in_mutable_structs"><code>const</code> on fields in <code>mutable structs</code></a></h2> <p><em>Jameson Nash</em></p> <p>Julia now supports annotating individual fields of a <code>mutable struct</code> with <code>const</code> annotations as:</p> <pre><code class=language-julia >mutable struct T
    x::Int
    const y::Float64
end</code></pre> <p>which causes the field <code>y</code> to be constant &#40;and thus cannot be reassigned after creation of the type&#41;. This can be used to enforce invariants but the compiler can also take advantage of it to improve the generated code.</p> <h2 id=call_site_inline ><a href="#call_site_inline">Call site <code>@inline</code></a></h2> <p><em>Shuhei Kadowaki</em></p> <p>Before Julia 1.8, the <code>@inline</code> macro could only be used on method definitions and the function would be inlined at all call sites of that method. However, it can be useful to make the choice for a given call site if a function should be inlined. Therefore, it is now possible to also apply the <code>@inline</code> macro to a given callsite as <code>@inline f&#40;x&#41;</code> which will tell the compiler to inline the method at that specific call.</p> <h2 id=typed_globals ><a href="#typed_globals">Typed globals</a></h2> <p><em>Simeon Schaub</em></p> <p>Non-constant global variables in Julia come with a performance penalty because the compiler cannot reason about their type since they during runtime can be reassigned to another object of some other type. In Julia 1.8, it is now possible to specify the type of a non-constant global variable using the <code>x::T</code> syntax where <code>T</code> is the type of the global. Trying to re-assign the variable to an object of another type errors:</p> <pre><code class=language-julia-repl >julia&gt; x::Int &#61; 0
0

julia&gt; x &#61; &quot;string&quot;
ERROR: MethodError: Cannot &#96;convert&#96; an object of type String to an object of type Int64
...</code></pre> <p>Type annotating global variables removes much &#40;but not all&#41; of the cost of using non-constant global variables.</p> <h2 id=new_default_scheduler_for_threads ><a href="#new_default_scheduler_for_threads">New default scheduler for <code>@threads</code></a></h2> <p><em>Takafumi Arakaki</em>, <em>Ian Butterworth</em> , <em>Jeff Bezanson</em></p> <p>Julia has had <code>@threads</code> macro for parallelizing a <code>for</code> loop even before the generic parallel task runtime was introduced in Julia 1.3. Due to this historical reason, <code>@threads</code> has been providing a static scheduling to avoid breaking programs accidentally relying on this strict behavior &#40;see <a href="https://docs.julialang.org/en/v1.8-dev/base/multi-threading/#Base.Threads.@threads"><code>:static</code> scheduling in the documentation</a>&#41;. Thus, to work nicely with the rest of the multitasking system, <a href="https://github.com/JuliaLang/julia/pull/35646">the <code>:static</code> scheduler was introduced in Julia 1.5</a> to help people prepare for changing the default scheduling behavior in the future; which is now&#33; In Julia 1.8, programs written with <code>@threads</code> can fully leverage the dynamic and composable task scheduler.</p> <p>To illustrate the improvement, consider the following program that simulates CPU-intensive work-load that requires <code>seconds</code> seconds to complete:</p> <pre><code class=language-julia-repl >julia&gt; function busywait&#40;seconds&#41;
            tstart &#61; time_ns&#40;&#41;
            while &#40;time_ns&#40;&#41; - tstart&#41; / 1e9 &lt; seconds
            end
        end;</code></pre> <p>Before Julia 1.8, <code>@threads</code> always uses all worker threads. As such, <code>@threads</code> do not complete until all previous tasks are complete:</p> <pre><code class=language-julia-repl >julia&gt; @time begin
            Threads.@spawn busywait&#40;5&#41;
            Threads.@threads for i in 1:Threads.nthreads&#40;&#41;
                busywait&#40;1&#41;
            end
        end
6.003001 seconds &#40;16.33 k allocations: 899.255 KiB, 0.25&#37; compilation time&#41;</code></pre> <p>The run-time is about 6 seconds. It means that one task internally created for <code>@threads</code> waits for the task <code>busywait&#40;5&#41;</code> to complete.</p> <p>However, in Julia 1.8, we have</p> <pre><code class=language-julia-repl >julia&gt; @time begin
            Threads.@spawn busywait&#40;5&#41;
            Threads.@threads for i in 1:Threads.nthreads&#40;&#41;
                busywait&#40;1&#41;
            end
        end
2.012056 seconds &#40;16.05 k allocations: 883.919 KiB, 0.66&#37; compilation time&#41;</code></pre> <p>It takes 2 seconds since one of the non-occupied threads can run two of the 1-second iterations to complete the for loop.</p> <h2 id=profiling ><a href="#profiling">Profiling</a></h2> <h3 id=new_allocation_profiler ><a href="#new_allocation_profiler">New allocation profiler</a></h3> <p><em>Pete Vilter</em>, <em>Nathan Daly</em></p> <p>Unnecessary heap allocations can seriously degrade performance, and existing tools for tracking them down &#40;namely <code>@time</code> and <code>--track-allocation</code>&#41; didn&#39;t quite provide the fine-grained detail, nice visualization, and ease of use we were looking for. So we created the allocation profiler &#40;<code>Profile.Allocs</code>&#41;, which captures heap allocations with the type, size, and stack trace of each, such that they can be easily visualized with <a href="https://github.com/JuliaPerf/PProf.jl">PProf.jl</a> and as seen below, with the Julia extension for VS Code.</p> <table><tr><th align=center ><img src="/assets/blog/2022-1.8-highlights/vscode_allocs.png" alt="" /><tr><td align=center >The Julia extension for VS Code provides easy access to illustrated allocation profiling via <code>@profview_allocs</code></table> <p>Happy allocation hunting&#33;</p> <h3 id=updates_to_cpu_profiling ><a href="#updates_to_cpu_profiling">Updates to CPU profiling</a></h3> <p><em>Ian Butterworth</em></p> <h4 id=thread_task_profiling ><a href="#thread_task_profiling">Thread &amp; task profiling</a></h4> <p>CPU profiling is now collected with metadata for each sample, including thread id and task id, meaning that profiling reports can be generated for specific threads or tasks, or groups thereof.</p> <pre><code class=language-julia >julia&gt; function myfunc&#40;&#41;
           A &#61; rand&#40;200, 200, 400&#41;
           maximum&#40;A&#41;
       end
myfunc &#40;generic function with 1 method&#41;

julia&gt; myfunc&#40;&#41; # run once to force compilation
0.9999999942189138

julia&gt; @profile myfunc&#40;&#41;
0.9999998811170847</code></pre> <p>The default print option remains the same, showing all threads and tasks grouped &#40;stacktraces have been cut short for brevity&#41;</p> <pre><code class=language-julia >julia&gt; Profile.print&#40;&#41;
Overhead ╎ &#91;&#43;additional indent&#93; Count File:Line; Function
&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
...
   ╎    ╎    ╎  70  REPL&#91;13&#93;:2; myfunc&#40;&#41;
   ╎    ╎    ╎   70  ...lialang/julia-release-1-dot-8/usr/share/julia/stdlib/v1.8/Random/src/Random.jl:278; rand
                 ...
   ╎    ╎    ╎  16  REPL&#91;13&#93;:3; myfunc&#40;&#41;
   ╎    ╎    ╎   16  @Base/reducedim.jl:994; maximum
                 ...
   ╎258 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
   ╎ 258 @Base/task.jl:930; wait&#40;&#41;
258╎  258 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;
Total snapshots: 344. Utilization: 25&#37; across all threads and tasks. Use the &#96;groupby&#96; kwarg to break down by thread and/or task</code></pre> <p>Now using the <code>groupby</code> kwarg to group the samples by thread id &#40;nthreads &#61; 4&#41;</p> <pre><code class=language-julia >julia&gt; Profile.print&#40;groupby&#61;:thread&#41;
Overhead ╎ &#91;&#43;additional indent&#93; Count File:Line; Function
&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
Thread 1 Total snapshots: 86. Utilization: 100&#37;
...
  ╎    ╎    ╎  70 REPL&#91;13&#93;:2; myfunc&#40;&#41;
  ╎    ╎    ╎   70 ...ulialang/julia-release-1-dot-8/usr/share/julia/stdlib/v1.8/Random/src/Random.jl:278; rand
                ...
  ╎    ╎    ╎  16 REPL&#91;13&#93;:3; myfunc&#40;&#41;
  ╎    ╎    ╎   16 @Base/reducedim.jl:994; maximum
                ...

Thread 2 Total snapshots: 86. Utilization: 0&#37;
  ╎86 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
  ╎ 86 @Base/task.jl:930; wait&#40;&#41;
85╎  86 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;

Thread 3 Total snapshots: 86. Utilization: 0&#37;
  ╎86 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
  ╎ 86 @Base/task.jl:930; wait&#40;&#41;
85╎  86 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;

Thread 4 Total snapshots: 86. Utilization: 0&#37;
  ╎86 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
  ╎ 86 @Base/task.jl:930; wait&#40;&#41;
85╎  86 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;</code></pre> <p>Note that each thread now shows a utilization percentage, showing that the only Julia thread that was notably active during the sampling was thread 1.</p> <p>External profile viewers now also support thread and task selection.</p> <table><tr><th align=center ><img src="/assets/blog/2022-1.8-highlights/thread_profile_profileview.png" alt="" /><th align=center ><img src="/assets/blog/2022-1.8-highlights/thread_profile_vscode.png" alt="" /><tr><td align=center >ProfileView.jl<td align=center >Julia extension for VS Code has a built-in <code>@profview</code> macro</table> <h4 id=profiling_code_that_is_already_running ><a href="#profiling_code_that_is_already_running">Profiling code that is already running</a></h4> <p>1.8 also introduces the option to profile code that is already running. Say you have started some long-running code and progress appears to slow. At any time you see what&#39;s happening without interrupting by triggering a 1-second profile via sending <code>SIGINFO</code> on BSDs including MacOS, or <code>SIGUSR1</code> on Linux &#40;not supported on Windows&#41;. MacOS &amp; FreeBSD have the added convenience of sending <code>SIGUSR1</code> via <code>ctrl-t</code>.</p> <p>First, an immediate stacktrace will print, followed by the report after the profile sampling at the next yield point.</p> <p>Here, the signal is sent shortly after executing the <code>sleep</code>. &#40;stacktraces have been cut short for brevity&#41;</p> <pre><code class=language-julia >julia&gt; sleep&#40;5&#41;
load: 2.82  cmd: julia 32246 waiting 37.66u 8.33s

&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
Information request received. A stacktrace will print followed by a 1.0-second profile
&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;

signal &#40;29&#41;: Information request: 29
__psynch_cvwait at /usr/lib/system/libsystem_kernel.dylib &#40;unknown line&#41;
_pthread_cond_wait at /usr/lib/system/libsystem_pthread.dylib &#40;unknown line&#41;
uv_cond_wait at /Applications/Julia-1.8.app/Contents/Resources/julia/lib/julia/libjulia-internal.1.8.dylib &#40;unknown line&#41;
ijl_task_get_next at /Applications/Julia-1.8.app/Contents/Resources/julia/lib/julia/libjulia-internal.1.8.dylib &#40;unknown line&#41;
poptask at ./task.jl:921
wait at ./task.jl:930
...

&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
Profile collected. A report will print at the next yield point
&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;

Overhead ╎ &#91;&#43;additional indent&#93; Count File:Line; Function
&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;&#61;
Thread 1 Task 0x000000010944c010 Total snapshots: 650. Utilization: 0&#37;
...
   ╎    ╎    ╎  650 @Base/asyncevent.jl:240; sleep&#40;sec::Int64&#41;
                ...

Thread 2 Task 0x00000001095487f0 Total snapshots: 650. Utilization: 0&#37;
   ╎650 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
   ╎ 650 @Base/task.jl:930; wait&#40;&#41;
649╎  650 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;

Thread 3 Task 0x000000010944c550 Total snapshots: 650. Utilization: 0&#37;
...
   ╎     650 @Base/task.jl:930; wait&#40;&#41;
649╎    ╎ 650 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;

Thread 4 Task 0x00000001095486a0 Total snapshots: 650. Utilization: 0&#37;
   ╎650 @Base/task.jl:634; task_done_hook&#40;t::Task&#41;
   ╎ 650 @Base/task.jl:930; wait&#40;&#41;
649╎  650 @Base/task.jl:921; poptask&#40;W::Base.InvasiveLinkedListSynchronized&#123;Task&#125;&#41;</code></pre> <h2 id=packages ><a href="#packages">Packages</a></h2> <h3 id=package_load_timing ><a href="#package_load_timing">Package load timing</a></h3> <p><em>Ian Butterworth</em></p> <p>A new tool has been added to provide insight into the way that loading dependencies contribute to the load time of a package.</p> <p>The macro is <code>InteractiveUtils.@time_imports</code> and it is directly available in the REPL.</p> <pre><code class=language-julia >julia&gt; @time_imports using CSV
     50.7 ms  Parsers 17.52&#37; compilation time
      0.2 ms  DataValueInterfaces
      1.6 ms  DataAPI
      0.1 ms  IteratorInterfaceExtensions
      0.1 ms  TableTraits
     17.5 ms  Tables
     26.8 ms  PooledArrays
    193.7 ms  SentinelArrays 75.12&#37; compilation time
      8.6 ms  InlineStrings
     20.3 ms  WeakRefStrings
      2.0 ms  TranscodingStreams
      1.4 ms  Zlib_jll
      1.8 ms  CodecZlib
      0.8 ms  Compat
     13.1 ms  FilePathsBase 28.39&#37; compilation time
   1681.2 ms  CSV 92.40&#37; compilation time</code></pre> <p>Any compilation time will be highlighted as a percentage of load time, and if any of that compile time is <a href="https://julialang.org/blog/2020/08/invalidations/">re-compiling invalidated methods</a>, that will be highlighted as a percentage of compile time.</p> <h3 id=pkg_status_update_with_upgradable_package_indicator ><a href="#pkg_status_update_with_upgradable_package_indicator">Pkg status update with upgradable package indicator</a></h3> <p><em>Ian Butterworth</em>, <em>Kristoffer Carlsson</em></p> <p>Packages in Julia tend to declare compatibility constraints on versions of their dependencies. This is done to ensure that you end up with a set of versions that should work well with each other. However, this means that sometimes the package manager might not give you the very latest version of all packages. Another reason why you might not have the latest version of a package is when new versions have been released since you last updated. This can sometimes be confusing when you for example hit a bug that has been fixed on a later version or when the documentation of the package is not in sync with what you are running locally.</p> <p>Therefore, the package manager will now show a small indicator when installing packages or when using the status output &#40;<code>pkg&gt; st</code>&#41; for packages that are not on the latest version. It will also try to predict if the package has a chance to be updated &#40;<code>pkg&gt; up</code>&#41; or if some other packages in your environment are &quot;holding it back&quot; &#40;have compatibility constraints that prevent the package from updating&#41;.</p> <p>There is also a new flag <code>--outdated</code> that can be passed to the status printing to see what the latest versions are and what packages&#39; compat is holding other packages back from updating.</p> <p><img src="/assets/blog/2022-1.8-highlights/pkg_upgrade.png" alt="" /></p> <p>Above, we can see that both Plots and NanMath are not on their latest version and Plots and RecipesPipeline are blocking NanMath from upgrading.</p> <h3 id=pkg_support_for_sysimages ><a href="#pkg_support_for_sysimages">Pkg support for sysimages</a></h3> <p><em>Kristoffer Carlsson</em></p> <p>Using the package PackageCompiler.jl it is possible to create a &quot;sysimage&quot; &#40;a prebaked serialized file&#41; with packages that can significantly improve the load time of these packages. A drawback to this is that when using a custom sysimage with packages, the version of those packages are &quot;frozen&quot; so that no matter what package version is installed in your environment, you will still end up loading the version that is in the sysimage. Explicitly, if you have version 0.1 of a package in the sysimage and you add version 0.2 with the package manager, you will still use version 0.1.</p> <p>In 1.8, the package manager understands when a custom sysimage is used and will not install packages for you at different versions than what is in the loaded sysimage.</p> <h2 id=improved_precompilation ><a href="#improved_precompilation">Improved precompilation</a></h2> <p><em>Tim Holy</em></p> <p>Julia precompiles packages by saving your module definitions in a second format &#40;cache files with extension <code>.ji</code>&#41; that can be loaded more quickly than the raw source files. These cache files include the modules, types, methods, global variables, and other objects in the package. To reduce the time for first execution of package methods, developers have long had the option to also save some of the outcomes of type-inference: one can add explicit <code>precompile</code> directives or insert a small workload that triggers compilation of the methods.</p> <p>Unfortunately, older Julia versions ended up throwing away a lot of this compiled code: type-inferred code was saved only for methods defined in the package, and for all other methods it was discarded. This meant that if your package needed a method in <code>Base</code> or another package that had not previously been inferred for the specific types needed by your package, you were out of luck–that method/type combination would always be freshly re-inferred in each new Julia session. Moreover, precompilation occasionally triggered a runtime performance hit: when Julia&#39;s compiler needed type-inferred code that had been discarded, it handled the omission by inserting an indirect invocation into the low-level CPU instructions that it compiles for your method. While this provided an opportunity to re-infer the methods for the required types, the indirect invocation allocated memory and reduced performance for all subsequent uses of the method.</p> <p>Julia 1.8 addresses both of these limitations by automatically saving all type-inferred code that links back to your package: either methods owned by your package or any newly-inferred code that can be proven by the compiler to be called by methods in your package. More specifically, all code that is linked to your package by a chain of successful type-inference will be cached; Julia only discards type-inference results for methods in other packages that were only called by runtime dispatch. This inference-chain requirement ensures that compilation that is performed to <em>build</em> your package, but which is not needed to <em>run</em> it &#40;e.g., code used only for metaprogramming or generating data&#41;, does not unnecessarily bloat the <code>.ji</code> files.</p> <p>With Julia 1.8, for workloads with &quot;predictable&quot; types, you can often entirely eliminate type-inference as a source of latency. The amount of savings depends on how much of the overall latency was due to type-inference; in tests with a dozen or so different packages, we have observed reductions in the time for an initial workload ranging from a few percent to 20-fold. Users of <a href="https://timholy.github.io/SnoopCompile.jl/stable/">SnoopCompile</a>&#39;s analysis tools will also find that the results of adding precompilation are much more predictable: for dispatch-trees that trace back to methods owned by your package, adding precompilation will eliminate all of their inference time. Thus, you can eliminate the worst offenders with the confidence that your intervention will have the intended effect.</p> <p>For those wishing for more background about precompilation, <a href="https://julialang.org/blog/2021/01/precompile_tutorial/">this blog post</a> and/or the SnoopCompile documentation may be useful.</p> <h2 id=improved_support_for_apple_silicon ><a href="#improved_support_for_apple_silicon">Improved support for Apple Silicon</a></h2> <p>Previously Julia 1.7 offered the <a href="https://julialang.org/blog/2021/11/julia-1.7-highlights/#support_for_apple_silicon">first experimental preview</a> of native builds of Julia on Apple Silicon. While this generally worked for basic usage, users experienced frequent segmentation faults, negatively affecting the experience. These problems were due to how Julia internally uses LLVM to generate and link the code for this platform and were eventually solved in Julia 1.8 by <a href="https://github.com/JuliaLang/julia/pull/43664">moving to a more modern linker</a>, which has better support for ARM CPUs on macOS. However, this fix required upgrading to LLVM 13, a change which cannot be backported to the v1.7 series. Therefore 1.7 will always be affected by frequent crashes on Apple Silicon.</p> <p>With 1.8, Apple Silicon becomes become a <a href="https://julialang.org/downloads/#supported_platforms">Tier 2 supported platform</a> and is now covered by Continuous Integration &#40;CI&#41; on dedicated Apple Silicon machines.</p> </div><br><br> <script src="/libs/highlight/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: ' '});</script> <footer class="container-fluid footer-copy"> <div class=container > <link href="https://cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel=stylesheet  type="text/css"> <style> #mc_embed_signup{ clear:left; font:14px Helvetica,Arial,sans-serif; } /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block. We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */ </style> <div id=mc_embed_signup > <form action="https://julialang.us14.list-manage.com/subscribe/post?u=d78e03c1818e29eeda84ff234&amp;id=c17a203547" method=post  id=mc-embedded-subscribe-form  name=mc-embedded-subscribe-form  class=validate  target=_blank  novalidate> <div id=mc_embed_signup_scroll > <div hidden=true ><input type=hidden  name=tags  value=7245945 ></div> <div id=mce-responses  class=clear  style="display: inline-block;"> <div class=response  id=mce-error-response  style="display:none"></div> <div class=response  id=mce-success-response  style="display:none"></div> </div> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px; display: inline-block;" aria-hidden=true ><input type=text  name=b_d78e03c1818e29eeda84ff234_c17a203547  tabindex=-1  value="" style="display: inline-block;"></div> <div class=clear  style="display: inline-block; display: flex; justify-content: center;"><h2 style="display: inline-block; margin-right: 15px; color:white;">Stay up to date on all things Julia!</h2><input type=email  value="" placeholder="Enter your email" name=EMAIL  class="required email" id=mce-EMAIL  style="margin-right: 15px; display: inline-block; align-self: center; line-height: 2em;"><input type=submit  value=Subscribe  name=subscribe  id=mc-embedded-subscribe  class=button  style="display: inline-block; align-self: center; margin: 0 5px 0 0;"></div> </div> </form> </div> <script type='text/javascript' src='https://s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script> <!--End mc_embed_signup--> <div class="row footrow"> <ul> <li><a href="/project">About</a> <li><a href="/about/help">Get Help</a> <li><a href="/governance/">Governance</a> <li><a href="/research/#publications">Publications</a> <li><a href="/research/#sponsors">Sponsors</a> </ul> <ul> <li><a href="/downloads/">Downloads</a> <li><a href="/downloads/">All Releases</a> <li><a href="https://github.com/JuliaLang/julia">Source Code</a> <li><a href="/downloads/#current_stable_release">Current Stable Release</a> <li><a href="/downloads/#long_term_support_release">Longterm Support Release</a> </ul> <ul> <li><a href="https://docs.julialang.org/en/v1/">Documentation</a> <li><a href="https://juliaacademy.com">JuliaAcademy</a> <li><a href="https://www.youtube.com/user/JuliaLanguage">YouTube</a> <li><a href="/learning/getting-started/">Getting Started</a> <li><a href="https://docs.julialang.org/en/v1/manual/faq/">FAQ</a> <li><a href="/learning/books">Books</a> </ul> <ul> <li><a href="/community/">Community</a> <li><a href="/community/standards/">Code of Conduct</a> <li><a href="/diversity/">Diversity</a> <li><a href="https://juliacon.org">JuliaCon</a> <li><a href="/community/#julia_user_and_developer_survey">User/Developer Survey</a> <li><a href="/shop/">Shop Merchandise</a> </ul> <ul> <li><a href="https://github.com/JuliaLang/julia/blob/master/CONTRIBUTING.md">Contributing</a> <li><a href="/contribute">Contributor's Guide</a> <li><a href="https://github.com/JuliaLang/julia/issues">Issue Tracker</a> <li><a href="https://github.com/JuliaLang/julia/security/policy">Report a Security Issue</a> <li><a href="https://github.com/search?q=is%3Aopen+is%3Aissue+language%3AJulia+label%3A%22help+wanted%22">Help Wanted Issues</a> <li><a href="https://github.com/search?q=is%3Aopen+is%3Aissue+language%3AJulia+label%3A%22good+first+issue%22">Good First Issue</a> <li><a href="https://docs.julialang.org/en/v1/devdocs/reflection/">Dev Docs</a> </ul> </div> <div id=footer-bottom  class=row > <div class="col-md-10 py-2"> <p>This site is powered by <a href="https://www.netlify.com">Netlify</a>, <a href="https://franklinjl.org">Franklin.jl</a>, and the <a href="https://julialang.org">Julia Programming Language</a>. We thank <a href="https://www.fastly.com">Fastly</a> for their generous infrastructure support.</p> <p>©2021 JuliaLang.org <a href="https://github.com/JuliaLang/www.julialang.org/graphs/contributors">contributors</a>. The content on this website is made available under the <a href="https://github.com/JuliaLang/www.julialang.org/blob/master/LICENSE.md">MIT license</a>. </div> <div class="col-md-2 py-2"> <span class=float-sm-right > <a class=github-button  href="https://github.com/sponsors/julialang" data-icon=octicon-heart  data-size=large  aria-label="Sponsor @julialang on GitHub">Sponsor</a> </span> </div> </div> </div> </footer> <script src="/libs/jquery/jquery.min.js"></script> <script src="/libs/bootstrap/bootstrap.min.js"></script>